<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: 1_baseView.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: 1_baseView.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * Base View. All other classes must inherit from it. 
 * @example MyClass = Framework.BaseView.extend({ });
 * @constructor
 * @export
 */
Framework.BaseView = Backbone.View.extend({
    /** @lends Framework.BaseView.prototype */
    template: null,
    
    isRendered: false,
    
    /** @private */
    _killChildren: function() {
        for (var i in this.viewsSack) {
            this.viewsSack[i].destroy();
        }
    },
    /** @private */
    initialize: function(options) {
        this.viewsSack = {};
        options || (options = {});
        this._options = options;
        
        if (this.parameterSchema) {
            for (var i in this.parameterSchema) {
                this[this.parameterSchema[i]] = this.getParameter(i);
            }
        }
        
        _.bindAll(this, 'render', 'destroy');
        
        var _this = this;
        this.render = _.wrap(this.render, function(render, b) {
            _this._beforeRender();
            render(b);
            _this.afterRender();
            return _this;
        });
        this.destroy = _.wrap(this.destroy, function(destroy, b, c, d) {
            _this._beforeDestroy();
            destroy(b, c, d);
            return _this;
        });
    },
    /** @private */
    _renderView: function(callback, data) {
        var success = function(html, preloadData) {
            
            data = data ? data : {};
            data._this = this;
            data._options = this._options;
            this._preloadData = preloadData;
            data._preloadData = preloadData;
            this.$el.html(_.template(html)(data));
            this.render();
            if (callback) {
                callback();
            }
        }.bind(this);
        if (this.template != null) {
            if (Framework.templateCache[this.template]) {
                this['preloadDataAsync'](function(data) {
                    success(Framework.templateCache[this.template], data);
                }, function() {
                    success("ERROR in preloadDataAsync", {});
                });
            
            } else {
                var ajaxSuccess = function(response) {
                    if (Framework.CACHE_TEMPLATES) {
                        Framework.templateCache[this.template] = response;
                    }
                    this['preloadDataAsync'](function(data) {
                        success(response, data);
                    }, function() {
                        success("ERROR in preloadDataAsync", {});
                    });
                }.bind(this);
                $.ajax({
                    url: this.template,
                    method: 'GET',
                    success: ajaxSuccess,
                    error: function(response) {
                        this.$el.html('template [' + this.template + '] failed to load.');
                    }.bind(this)
                });
            }
        } else {
            
            this['preloadDataAsync'](function(data) {
                this.render();
            }.bind(this), function() {
                this.$el.html("ERROR in preloadDataAsync");
            }.bind(this));
            
            if (callback) {
                callback();
            }
        }
    },
    /** @override */
    render: function() {
        return this;
    },
    /** @private */
    afterRender: function() {
        this.isRendered = true;
    },
    /** @private */
    _beforeRender: function() {
    
    },
    /** @private */
    _beforeDestroy: function() {
    // do all extra clean up here
    }

});

/** Use this method instead of $.ajax to get data
* This will ensure proper handling of xhr --
* If the view is destroyed before xhr completes, it will be aborted and any callbacks associated withit will not be executed. 
* @export {*} 
* @param {string} url to be passed in the ajax call
* @param {function} success callback on success of the xhr call
* @param {function} error callback method on error of the xhr call
* @param {object} options additional options such as type, data, etc..
* @example this.getJSON('/someUrl', function(data){
    console.log(data);
    }); 
});
*/
Framework.BaseView.prototype.getJSON = function(url, success, error, options) {
    if (!this._xhrs) {
        this._xhrs = [];
    }
    var xhr = $.ajax({
        headers: {
            Accept: "application/json"
        },
        cache: false,
        contentType: "application/json",
        type: "GET",
        processData: false,
        url: url,
        success: success,
        error: error
    });
    this._xhrs.push(xhr);
};



/** @export {function(string):string} */
Framework.BaseView.prototype.getParameter = function(parameter) {
    var hash = location.hash;
    if (hash.length == 0) {
        return null;
    }
    ;
    var params = hash.substr(1).split('&amp;');
    for (var i = 0, l = params.length; i &lt; l; i++) {
        var tokens = params[i].split('=');
        if (tokens[0] == parameter) {
            return tokens[1];
        }
    }
    return null;
};

/**
 * You can Use this method to set Url parameter
 * @example this.setParameter('q', 'name="test"');
 * @export {function(string,string)} 

*/
Framework.BaseView.prototype.setParameter = function(parameter, value) {
    var hash = location.hash;
    if (hash.length == 0) {
        hash = '#';
    }
    var params = hash.substr(1).split('&amp;');
    if (params[0] == '') {
        params = [];
    }
    var replaced = false;
    for (var i = 0, l = params.length; i &lt; l; i++) {
        var tokens = params[i].split('=');
        if (tokens[0] == parameter) {
            if (!value) {
                params[i] = '';
            } else {
                params[i] = parameter + '=' + value;
            }
            replaced = true;
            break;
        }
    }
    if (!replaced &amp;&amp; value) {
        params.push(parameter + '=' + value);
    }
    var noEmpty = [];
    for (var i = 0, l = params.length; i &lt; l; i++) {
        if (params[i]) {
            noEmpty.push(params[i]);
        }
    }
    location.hash = '#' + noEmpty.join('&amp;');
};
/** Destroys view. Removes all handles from parent, removes all rendered DOM elements (including this.$el)
* If there any xhr in progress created by this.getJSON, they will be aborted. Backbone events are undelegated.
* @todo Option not to remove parent div
* @fires Framework.BaseView#destroy
* @export {function()} */
Framework.BaseView.prototype.destroy = function() {
    // recursive destruction of all chidlren.
    this._killChildren();
    this.undelegateEvents();
    if (this._parent &amp;&amp; this._parent.viewsSack[this.cid]) {
        delete this._parent.viewsSack[this.cid];
    }
    this.$el.removeData().unbind();
    if (this.doNotKillDiv) {
        this.$el.empty();
        this.stopListening();
    } else {
        this.remove();
    }
    this.trigger('destroy', this);
};

/** 
* Renders View into desired DOM element (provided it is set prior with backbone's setElement(el) )
* Define template field with the path to your html template and it will be rendered then
* If you do not define template field, this method will not render template but goes directly to render()
* (render() executes last, regradless of whether the template is present or not )
* @example
MyView = Framework.BaseView.extend({
   template : 'templates/MyView.html' 
});

var myView = new MyView();
myView.setElement($('#myElement')).renderView();

@export {*} */

Framework.BaseView.prototype.renderView = function(callback, data) {
    if (this.loadingMessage) {
        this.$el.html(this.loadingMessage);
        this._renderView(callback, data);
    } else if (this.loadingTemplate) {
        if (Framework.templateCache[this.loadingTemplate]) {
            this.$el.html(Framework.templateCache[this.loadingTemplate]);
            this._renderView(callback, data);
        } else {
            this.$el.html("");
            $.ajax({
                url: this.loadingTemplate,
                method: 'GET',
                success: function(response) {
                    Framework.templateCache[this.loadingTemplate] = response;
                    this.renderView(callback, data);
                }.bind(this),
                error: function(response) {
                    Framework.templateCache[this.loadingTemplate] = 'Loading Template [' + this.loadingTemplate + '] failed to load.';
                    this.renderView(callback, data);
                }.bind(this)
            });
        }
    } else {
        this._renderView(callback, data);
    }
};

/** @export {*}
 *  @deprecated since version 1.0 use instantiate instead.
*/
Framework.BaseView.prototype.instantiateView = function(variableName, Constructor, options) {
    options = options ? options : {};
    this[variableName] = new Constructor(options);
    this.viewsSack[this[variableName].cid] = this[variableName];
    this[variableName]._parent = this;
    this[variableName]._varname = variableName;
    return this[variableName];
};



/** 
@param {Object} Constructor constructor of the class (must extend from Framework.BaseView);
@param {Object} options pass in additional options, they can be accessed immediately via this._options
@returns {Object} reference to new child view.
@example
MySubView = Framework.BaseView.extend({
    render : function(){
        this.$el.html('rendered. Proud child of ' + this._parent.cid);
    }
});

MyView = Framework.BaseView.extend({
    initialize : function(options){
        Framework.BaseView.prototype.initialize.call(this, options);
        this.mySubView = this.instantiate(MySubView);
    },
    render : function(){
        this.mySubView.setElement(this.$('#subView')).renderView();
    }
});
@export {*} */
Framework.BaseView.prototype.instantiate = function(Constructor, options) {
    options = options ? options : {}; 
    var view = new Constructor(options);
    this.viewsSack[view.cid] = view;
    view._parent = this;
    return view;
};

/** @export {*} 
* @returns {Object} returns parent view
*/
Framework.BaseView.prototype.getParent = function(){
    return this._parent;
}


/** @export {*} 
* @returns {Object|Array} returns all instantiated children views within this view
*/
Framework.BaseView.prototype.getChildren = function(){
    return this.viewsSack;
};
/** 
* Override this function to preload data asynchronously. Data will become available in this._preloadData after renderView() is called, but before render()
* @export {*} 
* @param {callback} callback function to be executed by base view upon completion

* @example 
MyView = Framework.BaseView.extend({
 preloadDataAsync : function(callback, error){  
    this.getJSON('/someUrl', callback, error); 
 },
 render : function(){
     console.log(this._preloadData);
 }
});

*/
Framework.BaseView.prototype.preloadDataAsync = function(callback, error) {
    callback({});
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_--%2520add%2520this%2520to%2520remove%2520the%2520warning.html"><-- add this to remove the warning</a></li><li><a href="Framework.AbstractConstraintModel.html">AbstractConstraintModel</a></li><li><a href="Framework.AbstractConstraintPanel.html">AbstractConstraintPanel</a></li><li><a href="Framework.BaseView.html">BaseView</a></li><li><a href="Framework.PaginationPanel.html">PaginationPanel</a></li><li><a href="Framework.PostConstraintModel.html">PostConstraintModel</a></li><li><a href="Framework.RestSource.html">RestSource</a></li><li><a href="Framework.ScrollPaginationPanel.html">ScrollPaginationPanel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#render">render</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Mon Nov 02 2015 15:47:18 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
